<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>专业扫码工具</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* 新增提示样式 */
        .scan-toast.error {
            background: rgba(255,59,48,0.95); /* iOS红色 */
            box-shadow: 0 4px 12px rgba(255,59,48,0.3);
        }
    </style>
</head>
<body>
    <!-- 新增重复扫描提示 -->
    <div class="scan-toast" id="duplicateToast">⚠️ 重复扫描</div>

    <script>
        // 音频管理
        let audioContext = null;
        let oscillator = null;

        // 初始化音频
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        // 播放提示音
        function playBeep() {
            if (!audioContext) return;
            
            oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);

            // iOS恢复静音状态
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        // 修改扫描处理逻辑
        function handleScan(data) {
            const isDuplicate = state.scanHistory.some(item => item.data === data);
            
            if (isDuplicate) {
                showToast(elements.duplicateToast);
                return;
            }

            state.scanHistory.unshift({
                data: data,
                time: new Date().toLocaleString()
            });

            playBeep();
            showToast(elements.scanToast);
            updateHistoryList();
        }

        // 通用提示显示
        function showToast(toastElement) {
            clearTimeout(toastElement.timeout);
            toastElement.classList.remove('visible');
            
            void toastElement.offsetWidth; // 强制重绘
            toastElement.classList.add('visible');
            
            toastElement.timeout = setTimeout(() => {
                toastElement.classList.remove('visible');
            }, 1500);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>专业扫码工具</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #007AFF;
            --error: #FF3B30;
            --background: #FFFFFF;
            --overlay: rgba(0,0,0,0.4);
            --surface: #F2F2F7;
        }

        /* 提示样式 */
        .scan-toast {
            position: fixed;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            padding: 14px 28px;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            z-index: 1001;
            pointer-events: none;
            backdrop-filter: blur(10px);
            white-space: nowrap;
        }

        .scan-toast.visible {
            opacity: 1;
            transform: translate(-50%, -10px);
        }

        .scan-toast.success {
            background: rgba(0,122,255,0.95);
            box-shadow: 0 4px 12px rgba(0,122,255,0.3);
        }

        .scan-toast.error {
            background: rgba(255,59,48,0.95);
            box-shadow: 0 4px 12px rgba(255,59,48,0.3);
        }
    </style>
</head>
<body>
    <!-- 原有结构保持不变，新增以下提示 -->
    <div class="scan-toast success" id="scanToast">✓ 扫描成功</div>
    <div class="scan-toast error" id="duplicateToast">⚠️ 重复扫描</div>

    <script>
        // 新增音频相关代码
        let audioContext = null;

        // 初始化音频（在用户首次交互时调用）
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // 修改后的扫描处理
        function handleScan(data) {
            const isDuplicate = state.scanHistory.some(item => item.data === data);
            
            if (isDuplicate) {
                showToast(elements.duplicateToast);
                return;
            }

            // 成功扫描处理
            state.scanHistory.unshift({
                data: data,
                time: new Date().toLocaleString()
            });

            playBeep();
            showToast(elements.scanToast);
            updateHistoryList();
        }

        // 播放提示音
        function playBeep() {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);

            // iOS音频恢复
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        // 在按钮点击时初始化音频
        document.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
                initAudio();
            });
        });
    </script>
</body>
</html>
